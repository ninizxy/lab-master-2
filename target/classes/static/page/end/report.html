<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta HTTP-EQUIV="pragma" CONTENT="no-cache">
    <meta HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate">
    <meta HTTP-EQUIV="expires" CONTENT="0">
    <title>实验报告</title>
    <link rel="stylesheet" href="../../css/element.css">
    <link rel="stylesheet" href="../../css/base.css">

    <style>

    </style>
</head>
<body>
<div id="wrapper" v-cloak>
    <!--    -->
    <div style="padding-bottom: 10px">
        <el-breadcrumb separator-class="el-icon-arrow-right">
            <el-breadcrumb-item @click.native="parent.changeIndex('index')">首页</el-breadcrumb-item>
            <el-breadcrumb-item>实验报告</el-breadcrumb-item>
        </el-breadcrumb>
    </div>

    <!-- sku组合可视化显示 -->
    <el-form :model="listModel" ref="listModel">
        <el-table :data="listModel.sku_list" border stripe>
            <el-table-column prop="序号" label="序号"></el-table-column>
            <el-table-column prop="科目名称" label="科目名称"></el-table-column>
            <el-table-column prop="单位" label="单位"></el-table-column>

            <el-table-column label="数值" align="center">
                <template slot-scope="scope">
                    <el-form-item :prop="'sku_list.' + scope.$index + '.'+'数值'" :rules="skuRule.数值">
                        <el-input
                                style="margin-top:15px"
                                placeholder="请输入"
                                v-model="scope.row.数值"
                                @change="setNum(scope.row)"
                                clearable></el-input>
                    </el-form-item>
                </template>
            </el-table-column>

            <el-table-column label="备注" align="center">
                <template slot-scope="scope">
                    <el-form-item :prop="'sku_list.' + scope.$index + '.'+'备注'" :rules="skuRule.备注">
                        <el-input
                                style="margin-top:15px"
                                placeholder="请输入"
                                v-model="scope.row.备注"
                                @change="setRemark(scope.row)"
                                clearable></el-input>
                    </el-form-item>
                </template>
            </el-table-column>

        </el-table>
    </el-form>

    <div style="height: 1px; margin: 10px 0; background-color: white" >
        <el-button type="primary"  @click="save()">暂 存</el-button>
        <el-button type="primary" @click="submit()">提 交</el-button>
        <el-button type="text" @click="dialogFormVisible = true" >查看上次提交/暂存内容</el-button>
    </div>

    <el-dialog title="历史提交/暂存内容" :visible.sync="dialogFormVisible" width="40%" :close-on-click-modal="false">
        <span>数值1：{{this.seeEntity.num1}}</span></br>
        <span>数值2：{{this.seeEntity.num2}}</span></br>
        <span>数值3：{{this.seeEntity.num3}}</span></br>
        <span>数值4：{{this.seeEntity.num4}}</span></br>
        <span>数值5：{{this.seeEntity.num5}}</span></br>
        <span>备注1：{{this.seeEntity.remark1}}</span></br>
        <span>备注2：{{this.seeEntity.remark2}}</span></br>
        <span>备注3：{{this.seeEntity.remark3}}</span></br>
        <span>备注4：{{this.seeEntity.remark4}}</span></br>
        <span>备注5：{{this.seeEntity.remark5}}</span>
<!--        这种方式走不通-->
<!--        <el-table :data = "this.seeEntity" border style="width: 100%">-->
<!--            <el-table-column prop="num1" label="数值1"></el-table-column>-->
<!--            <el-table-column prop="num2" label="数值2"></el-table-column>-->
<!--            <el-table-column prop="num3" label="数值3"></el-table-column>-->
<!--            <el-table-column prop="num4" label="数值4"></el-table-column>-->
<!--            <el-table-column prop="num5" label="数值5"></el-table-column>-->
<!--            <el-table-column prop="remark1" label="备注1"></el-table-column>-->
<!--            <el-table-column prop="remark2" label="备注2"></el-table-column>-->
<!--            <el-table-column prop="remark3" label="备注3"></el-table-column>-->
<!--            <el-table-column prop="remark4" label="备注4"></el-table-column>-->
<!--            <el-table-column prop="remark5" label="备注5"></el-table-column>-->
<!--        </el-table>-->
    </el-dialog>
</div>

<script src="../../js/jquery.min.js"></script>
<script src="../../js/vue.min.js"></script>
<script src="../../js/element.js"></script>
<script src="../../js/tinymce/tinymce.min.js"></script>


<script>

    let urlBase;
    urlBase = "/api/report/";
    new Vue({
        el: "#wrapper",
        data() {
            user: {}
            return {
                dialogFormVisible: false,
                listModel: {
                    sku_list: [
                        {
                            序号:1,
                            科目名称:"规模估算——初始功能点",
                            数值:0,
                            单位:"功能点",
                            备注:"无"
                        },
                        {
                            序号:2,
                            科目名称:"规模变更调整因子",
                            数值:0,
                            单位:"",
                            备注:"无"
                        },
                        {
                            序号:3,
                            科目名称:"规模估算——初始功能点",
                            数值:0,
                            单位:"功能点",
                            备注:"无"
                        },
                        {
                            序号:4,
                            科目名称:"基准生产率",
                            数值:0,
                            单位:"人时/功能点",
                            备注:"无"
                        },
                        {
                            序号:5,
                            科目名称:"未调整工作量",
                            数值:0,
                            单位:"人月",
                            备注:"无"
                        }

                    ]
                },
                entity:{
                    id:0,
                    report_id:1,
                    num1:0,
                    num2:0,
                    num3:0,
                    num4:0,
                    num5:0,
                    remark1:"",
                    remark2:"",
                    remark3:"",
                    remark4:"",
                    remark5:"",
                    submited:0,
                    the_score:0,
                    corrected:0,
                },
                seeEntity:{
                    id:0,
                    report_id:1,
                    num1:0,
                    num2:0,
                    num3:0,
                    num4:0,
                    num5:0,
                    remark1:"",
                    remark2:"",
                    remark3:"",
                    remark4:"",
                    remark5:"",
                    submited:0,
                    the_score:0,
                    corrected:0,
                },
                skuRule: {
                    num: [{ required: true, message: '该项不能为空', trigger: 'blur' }],
                    remark: [{ required: true, message: '该项不能为空', trigger: 'blur' }],
                },
            };
        },
        created() {
            this.user = sessionStorage.getItem("user") ? JSON.parse(sessionStorage.getItem("user")) : {};
            this.entity.id=this.user.id;
            // console.log(this.listModel.sku_list);
            this.loadTable()
        },

        methods: {
            handleCollapse() {
                this.isCollapse = !this.isCollapse;
            },
            logout() {
                $.get("/api/user/logout");
                sessionStorage.removeItem("user");
                location.href = "/page/end/login.html";
            },
            exp() {
                window.open(urlBase + "/export");
            },
            setRemark(id) {
                console.log("Remark changed")
                // console.log(id)
                if (id.序号 == 1) {
                    this.entity.remark1 = id.备注;
                    console.log(this.entity.remark1)
                }
                if (id.序号 == 2) {
                    this.entity.remark2 = id.备注;
                    console.log(this.entity.remark2)
                }
                if (id.序号 == 3) {
                    this.entity.remark3 = id.备注;
                    console.log(this.entity.remark3)
                }
                if (id.序号 == 4) {
                    this.entity.remark4 = id.备注;
                    console.log(this.entity.remark4)
                }
                if (id.序号 == 5) {
                    this.entity.remark5 = id.备注;
                    console.log(this.entity.remark5)
                }
            },
            setNum(id) {
                console.log("Num changed")
                if (id.序号 == 1) {
                    this.entity.num1 = id.数值;
                    console.log(this.entity.num1)
                }
                if (id.序号 == 2) {
                    this.entity.num2 = id.数值;
                    console.log(this.entity.num2)
                }
                if (id.序号 == 3) {
                    this.entity.num3 = id.数值;
                    console.log(this.entity.num3)
                }
                if (id.序号 == 4) {
                    this.entity.num4 = id.数值;
                    console.log(this.entity.num4)
                }
                if (id.序号 == 5) {
                    this.entity.num5 = id.数值;
                    console.log(this.entity.num5)
                }
            },
            loadTable() {//没用，显示历史记录的时候用
                $.get(urlBase + "/" + this.user.id).then(res => {
                    this.seeEntity=res.data;
                })
                // console.log(urlBase +"/" + this.user.id)
            },//已测，对的
            save() {
                // console.log(this.entity)
                this.entity.report_id = 1,
                    $.ajax({
                        url: urlBase,
                        type: 'POST',
                        contentType: "application/json",
                        data: JSON.stringify(this.entity)
                    }).then(res => {
                        if (res.code === '0') {
                            this.$message({
                                message: "保存成功",
                                type: "success"
                            });
                            this.loadTable();
                        } else {
                            this.$message({
                                message: res.msg,
                                type: "error"
                            })
                        }
                        this.entity = {}
                        $.get(urlBase + "/" + this.user.id).then(res => {
                            console.log(res)
                        })
                        console.log("res:" + res)
                        this.dialogFormVisible = false;
                    })
            },
            submit() {
                // console.log(this.entity)
                this.entity.submited = 1,
                    $.ajax({
                        url: urlBase,
                        type: 'PUT',
                        contentType: "application/json",
                        data: JSON.stringify(this.entity)
                    }).then(res => {
                        if (res.code === '0') {
                            this.$message({
                                message: "保存成功",
                                type: "success"
                            });
                            this.loadTable();
                        } else {
                            this.$message({
                                message: res.msg,
                                type: "error"
                            })
                        }
                        this.entity = {}
                        $.get(urlBase + "/" + this.user.id).then(res => {
                            console.log(res)
                        })
                        console.log("res:" + res)
                        this.dialogFormVisible = false;
                    })
            },
        }
    })
</script>
</body>
</html>


