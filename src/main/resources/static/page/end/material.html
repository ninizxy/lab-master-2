<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta HTTP-EQUIV="pragma" CONTENT="no-cache">
    <meta HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate">
    <meta HTTP-EQUIV="expires" CONTENT="0">
    <title>资料管理</title>
    <link rel="stylesheet" href="../../css/element.css">
    <link rel="stylesheet" href="../../css/base.css">
</head>
<body>
<div id="wrapper" v-cloak>
    <div style="padding-bottom: 10px">
            <el-breadcrumb separator-class="el-icon-arrow-right">
                <el-breadcrumb-item @click.native="parent.changeIndex('index')">首页</el-breadcrumb-item>
                <el-breadcrumb-item>资料管理</el-breadcrumb-item>
            </el-breadcrumb>
        </div>

        <div style="height: 1px; margin: 10px 0; background-color: white"></div>
<!--    <el-input size='small' v-model="search" style="width: 20%;" suffix-icon="el-icon-search" placeholder="请输入名称按回车搜索"-->
<!--              @keyup.enter.native="loadTable"></el-input>-->
<!--    <el-button size='small' @click="add" type="primary"  style="margin: 10px 0">新增</el-button>-->
<!--    <el-upload action="/files/upload" :on-success="successUpload" :show-file-list="false" style="display: inline-block">-->
<!--        <el-button size='small' type="primary">导入</el-button>-->
<!--    </el-upload>-->
<!--    <el-button size='small' @click="exp" type="primary"  style="margin: 10px 0">导出</el-button>-->
    <!--    标签-->
    <template>
        <el-tabs type="border-card" @tab-click="changeState" v-model="fileName">

            <el-tab-pane label="实验一" name="ExperimentOne">
                <el-row :gutter="20" v-if="tabsArr.ExperimentOne">
                    <el-col :span="8">
                        <el-upload
                                class="upload-demo"
                                drag
                                :on-success="successUpload"
                                action="/api/material/ExperimentOne/1"
                                multiple
                        >
                            <div style="margin: 70px " class="el-upload__text">
                                Drop file here or <em>click to upload</em>
                            </div>
                        </el-upload>
                    </el-col>
                    <el-col :span="16">
                        <el-table :data="tableData" border stripe style="width: 100%">
                            <el-table-column prop="materialName" label="材料名称"></el-table-column>
                            <el-table-column prop="time" label="上传时间"></el-table-column>
                            <el-table-column
                                    fixed="right"
                                    label="操作"
                                    width="200">
                                <template slot-scope="scope">
                                    <el-button type="primary" icon="el-icon-download" circle size='small' @click="download(scope.row.materialId)"></el-button>
                                    <el-popconfirm
                                            @onConfirm="del(scope.row.materialId,scope.row.id)"
                                            title="确定删除？"
                                    >
                                        <el-button size='small' type="danger" icon="el-icon-delete" circle slot="reference" style="margin-left: 10px"></el-button>
                                    </el-popconfirm>
                                </template>
                            </el-table-column>
                        </el-table>
                    </el-col>
                </el-row>
            </el-tab-pane>
            <el-tab-pane label="实验二" name="ExperimentTwo">
                <el-row :gutter="20" v-if="tabsArr.ExperimentTwo">
                    <el-col :span="8">
                        <el-upload
                                class="upload-demo"
                                drag
                                :on-success="successUpload"
                                action="/api/material/ExperimentTwo/2"
                                multiple
                        >
                            <div style="margin: 70px " class="el-upload__text">
                                Drop file here or <em>click to upload</em>
                            </div>
                        </el-upload>
                    </el-col>
                    <el-col :span="16">
                        <el-table :data="tableData" border stripe style="width: 100%">
                            <el-table-column prop="materialName" label="材料名称"></el-table-column>
                            <el-table-column prop="time" label="上传时间"></el-table-column>
                            <el-table-column
                                    fixed="right"
                                    label="操作"
                                    width="200">
                                <template slot-scope="scope">
                                    <el-button type="primary" icon="el-icon-download" circle size='small' @click="download(scope.row.materialId)"></el-button>
                                    <el-popconfirm
                                            @onConfirm="del(scope.row.materialId,scope.row.id)"
                                            title="确定删除？"
                                    >
                                        <el-button size='small' type="danger" icon="el-icon-delete" circle slot="reference" style="margin-left: 10px"></el-button>
                                    </el-popconfirm>
                                </template>
                            </el-table-column>
                        </el-table>
                    </el-col>
                </el-row>
            </el-tab-pane>
            <el-tab-pane label="实验三" name="ExperimentThree">
                <el-row :gutter="20" v-if="tabsArr.ExperimentThree">
                    <el-col :span="8">
                        <el-upload
                                class="upload-demo"
                                drag
                                :on-success="successUpload"
                                action="/api/material/ExperimentThree/3"
                                multiple
                        >
                            <div style="margin: 70px " class="el-upload__text">
                                Drop file here or <em>click to upload</em>
                            </div>
                        </el-upload>
                    </el-col>
                    <el-col :span="16">
                        <el-table :data="tableData" border stripe style="width: 100%">
                            <el-table-column prop="materialName" label="材料名称"></el-table-column>
                            <el-table-column prop="time" label="上传时间"></el-table-column>
                            <el-table-column
                                    fixed="right"
                                    label="操作"
                                    width="200">
                                <template slot-scope="scope">
                                    <el-button type="primary" icon="el-icon-download" circle size='small' @click="download(scope.row.materialId)"></el-button>
                                    <el-popconfirm
                                            @onConfirm="del(scope.row.materialId,scope.row.id)"
                                            title="确定删除？"
                                    >
                                        <el-button size='small' type="danger" icon="el-icon-delete" circle slot="reference" style="margin-left: 10px"></el-button>
                                    </el-popconfirm>
                                </template>
                            </el-table-column>
                        </el-table>
                    </el-col>
                </el-row>
            </el-tab-pane>
        </el-tabs>
    </template>


    <!-- 分页 -->
    <div style="background-color: white">
        <el-pagination
                @size-change="handleSizeChange"
                @current-change="handleCurrentChange"
                :current-page="pageNum"
                :page-sizes="[5, 10, 20, 40]"
                :page-size="pageSize"
                layout="total, sizes, prev, pager, next, jumper"
                :total="total">
        </el-pagination>
    </div>


</div>

<script src="../../js/jquery.min.js"></script>
<script src="../../js/vue.min.js"></script>
<script src="../../js/element.js"></script>
<script src="../../js/tinymce/tinymce.min.js"></script>


<script>

    let urlBase = "/api/material/";
    new Vue({
        el: "#wrapper",
        data: {
            options: [],
            fileList: [],
            user: {},
            tableData: [],
            pageNum: 1,
            pageSize: 10,
            total: 0,
            dialogFormVisible: false,
            entity: {},
            isCollapse: false,
            search:'1',
            fileName:'ExperimentOne',//文件夹的名字默认为实验一的文件夹

            tabsArr: {
                ExperimentOne: true,
                ExperimentTwo: false,
                ExperimentThree: false,
            },

        },
        created() {
            this.user = sessionStorage.getItem("user") ? JSON.parse(sessionStorage.getItem("user")) : {};
            this.loadTable();
        },
        methods: {
            fileSuccessUpload(res) {
                this.entity.file = "http://localhost:9999/files/" + res.data;
                this.entity.img = "http://localhost:9999/files/" + res.data;
                console.log(res)
            },
            successUpload(res) {
                if (res.code === '0') {
                    this.$message({
                        message: "上传成功",
                        type: "success"
                    });
                    this.loadTable()
                }
            },

            //标签栏转换状态
            changeState(tab) {
                console.log(tab.index);
                for (const key in this.tabsArr) {
                    this.tabsArr[key] = tab.name === key;
                };
                if (tab.index === '0') {
                    this.search='1';
                }else if(tab.index === '1'){
                    this.search='2';
                }else if(tab.index==='2'){
                    this.search='3';
                }
                this.loadTable();
                console.log(this.fileName);
            },

            handleCollapse() {
                this.isCollapse = !this.isCollapse;
            },

            logout() {
                $.get("/api/user/logout");
                sessionStorage.removeItem("user");
                location.href = "/page/end/login.html";
            },

            loadTable() {
                $.get(urlBase + "/page?pageNum=" + this.pageNum + "&pageSize=" + this.pageSize + "&name=" + this.search).then(res => {
                    this.tableData = res.data.records;
                    this.total = res.data.total;
                })

                 // $.get("/api/").then(res => {
                    // this.options = res.data;
                 // })
            },

            handleSizeChange(pageSize) {
                this.pageSize = pageSize;
                this.loadTable();
            },
            handleCurrentChange(pageNum) {
                this.pageNum = pageNum;
                this.loadTable();
            },

            add() {
                this.entity = {};
                this.fileList = [];
                this.dialogFormVisible = true;
            },

            // 下载文件
            download(materialId){
                window.open(urlBase+this.fileName+ "/"+materialId);
            },


            //删除文件
            del(materialId,id) {
                //从文件夹下删除
                $.ajax({
                    url: urlBase + this.fileName+"/"+materialId,
                    type: "delete",
                }).then(res => {
                })

                //从数据库中删除
                $.ajax({
                    url: urlBase + id,
                    type: "delete"
                }).then(res => {
                    if (res.code === '0') {
                        this.$message({
                            message: "删除成功",
                            type: "success"
                        })
                        this.loadTable();
                    } else {
                        this.$message({
                            message: res.msg,
                            type: "error"
                        })
                    }
                })
            }
        }
    })
</script>
</body>
</html>
